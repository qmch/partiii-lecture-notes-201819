We've been working in the Schr\"odinger picture where the states evolve in time, but now it will be useful to pass to the Heisenberg picture, where the states are fixed and the \emph{operators} evolve in time.

In the Schr\"odinger picture, it's not obvious how our theory is Lorentz invariant. We seem to have picked out time as a special dimension when we write things down (even though we started with a Lorentz invariant theory, so our final theory should still be Lorentz invariant). The operators $\phi(\vec x)$ don't depend on $t$, but the states evolve as
$$i \frac{d\ket{p}}{dt}=H\ket{p} = E_p\ket{p} \implies \ket{p(t)}= e^{-i E_pt} \ket{p(0)}.$$
In the Heisenberg picture, things look a bit better for covariance, since time dependence is moved into the operators. Denoting Heisenberg picture operators as $O_H$ and Schr\"odinger picture operators as $O_S$, we have%
    \footnote{Here, the exponential of an operator is simply defined in terms of the series expansion of $e$, e.g. $e^{iHt}=\sum_{n=0}^\infty \frac{(iHt)^n}{n!}$.}
$$O_H(t) \equiv e^{iHt}O_S e^{-iHt}.$$
Taking the time derivative of each side, one finds that%
    \footnote{Explicitly, $\frac{d O_H(t)}{dt}= iH e^{iHt} O_S e^{-iHt}+e^{iHt}O_S (-iH) e^{-iHt} = i e^{iHt} [H,O_S] e^{-iHt} = i[H,O_H]$ since $e^{iHt}H e^{-iHt}=H$. We also see from this computation that it doesn't matter to the Hamiltonian itself what picture we're in, since $H_S=H_H$.}
$$\frac{dO_H}{dt}=i[H,O_H].$$
This is the general time evolution of operators in the Heisenberg picture. It's clear that $O_H(t=0)=O_S$, so our operators agree at $t=0$ (but in general nowhere else). The field commutators then become \emph{equal time commutation relations}:
$$[\phi(\vec x,t),\phi(\vec y, t)]=[\pi(\vec x, t), \pi(\vec y,t)]=0$$
and
$$[\phi(\vec x, t), \pi (\vec y, t)]=i \delta^3(\vec x-\vec y).$$

\begin{ex}\label{heisenbergkleingordon}
One should check (exercise) that $\frac{d\phi}{dt}=i[H,\phi]$ now means that the Heisenberg picture operator $\phi_H$ satisfies the Klein-Gordon equation, $\p_\mu \p^\mu \phi+ m^2 \phi=0$.
\end{ex}
We now write the Fourier transform of $\phi(x)$ (where $x$ is now a four-vector) by deriving
$$e^{iHt}a_{\pv} e^{-iHt}=e^{-iE_p t} a_{\pv}$$
and
$$e^{iHt}a_{\pv}^\dagger e^{-iHt}=e^{+iE_p t} a_{\pv}^\dagger.$$
You should also check this (exercise) using the commutation relation $[H,a_{\pv}]=-E_p a_{\pv}$.

Therefore we can now write
$$\phi(\vec x, t)=\int \frac{d^3p}{(2\pi)^3} \frac{1}{\sqrt{2E_p}} \set{ a_{\pv} e^{-i p\cdot x}+a_{\pv}^\dagger e^{+i p\cdot x}}$$
where $x$ and $p$ are now four-vectors and $p_0= E_p$.

\subsection*{Causality} We might be concerned about the causal structure of this theory, since $\phi$ and $\pi$ satisfy equal-time commutation relations. In general a Lorentz transform might mix up events which in one frame take place at ``equal times.'' So what about arbitrary space-time separations? It turns out that causality requires that the commutators of spacelike separated operators is zero, i.e. two events which are spacelike separated cannot impact one another.
$$[O_1(x),O_2(y)]=0 \quad\forall (x-y)^2 <0.$$

Does this condition hold for our field operators? Let's define
$$\Delta(x-y)\equiv [\phi(x),\phi(y)]$$
and expand in the Fourier basis.
\begin{align*}
\Delta(x-y) &= \int \frac{d^3p}{(2\pi)^6} \frac{d^3p'}{\sqrt{4E_p E_{p'}}} \left([a_{\pv},a_{\pv'}^\dagger] e^{-i(p\cdot x - p' \cdot y)}+[a_{\pv}^\dagger, a_{\pv'}] e^{i(p\cdot x-p' \cdot y)}\right)\\
&= \int \frac{d^3p}{2E_p(2\pi)^3}\left(e^{-ip\cdot (x-y)}-e^{i p \cdot (x-y)}\right)
\end{align*}
Remarkably, this is just a $c$-number-- it's not an operator at all but a (classical) number.\footnote{Wikipedia says this terminology is due to Dirac, who coined it to contrast with q-numbers (quantum numbers), which are just operators.} It is Lorentz invariant since the integration measure $d^3p/(2E_p)$ is Lorentz invariant and the integrand is too (it depends only on $p\cdot (x-y)$, which is the product of two four-vectors, and is therefore an invariant scalar). Moreover, each term is separately Lorentz invariant. In addition, if $x-y$ is spacelike then $x-y$ can be Lorentz transformed to $y-x$ in the first term, giving $0$. It does not vanish for timelike separations, e.g.
$$[\phi (\vec x,0), \phi(\vec x,t)] = \int \frac{d^3p}{(2\pi)^3 2 E_p}(e^{-imt}-e^{+imt})\neq 0.$$
And at equal times 
$$[\phi(\vec x,t),\phi(\vec y, t)]=\int \frac{d^3p}{(2\pi)^3 2E_p}(e^{i\vec p \cdot (\vec x - \vec y)}- e^{-i \vec p \cdot (\vec x- \vec y)})=0$$
(since we can send the integration variable $\vec p\to -\vec p$). One can also see in this way that the commutator for spacelike separated operators vanishes, since a general spacelike separation can always be transformed into a frame where the two events take place at equal times.

\begin{defn}
We can then introduce the idea of a \term{propagator}-- if we initially prepare a particle at point $y$, what is the amplitude to find it at $x$? We can write this as
%
\begin{align*}
    \bra{0}\phi(x) \phi(y)\ket{0}&=\int \frac{d^3p d^3 p'}{(2\pi)^6 \sqrt{4 E_p E_{p'}}} \bra{0} a_{\pv} a_{\pv'}^\dagger \ket{0} e^{-ip \cdot x +i p'\cdot y}\\
    &=\int \frac{d^3p d^3 p'}{(2\pi)^6\sqrt{4 E_p E_{p'}}} \bra{0} [a_{\pv}, a_{\pv'}^\dagger] \ket{0}e^{-ip \cdot x +i p'\cdot y}\\
    &=\int \frac{d^3p d^3 p'}{(2\pi)^3\sqrt{4 E_p E_{p'}}} \delta^3 (\vec p- \vec p') e^{-ip \cdot x +i p'\cdot y}\\
    &=\int \frac{d^3p}{(2\pi)^3 2 E_p}e^{-ip\cdot (x-y)} \equiv D(x-y),
\end{align*}
%
where we have used the fact that $a_{\pv}$ kills the ground state (so we can freely replace $a_{\pv} a_{\pv'}^\dagger$ with the commutator $[a_{\pv},a_{\pv'}^\dagger]$) and used the resulting delta function to integrate over $d^3p'$.
\end{defn}

In fact, one can show\footnote{The easiest way to do this is to set $y=0$ and take $x$ and $y$ at equal times, $x^0=y^0=0$. This gets rid of $p^0$, and from here you can switch to spherical coordinates, rewriting $\vec p \cdot (x)$ as $|p||x|\cos\theta$.} that for spacelike separations $(x-y)^2<0,$ the propagator decays as $D(x-y)\sim e^{-m|\vec x-\vec y|}.$ The quantum field seems to ``leak'' out of the light cone. But we also computed that
$$\Delta(x-y)=[\phi(x),\phi(y)] =D(x-y)-D(y-x)=0$$ if $(x-y)^2<0$. We can interpret this to mean that there's no Lorentz invariant way to order the two events at $x$ and $y$. A particle can travel as easily from $y\to x$ as $x\to y$, so in a quantum measurement these two amplitudes cancel. With a complex scalar field, the story is more interesting. We find instead that the amplitude for a particle to go from $x\to y$ is cancelled by the amplitude for an anti-particle to go from $y\to x$.\footnote{See also Wheeler's ``one-electron universe''-- \url{https://en.wikipedia.org/wiki/One-electron_universe}.} This is also the case for the real scalar field, except the particle is its own antiparticle.

\begin{defn}
We now introduce the \term{Feynman propagator} $\Delta_F$, which is like a regular propagator but with time ordering baked in. That is,
$$\Delta_F =\begin{cases}
  \bra{0}\phi(x)\phi(y)\ket{0} & \text{for } x^0 > y^0\\    
  \bra{0}\phi(y)\phi(x)\ket{0} & \text{for } y^0 > x^0.
\end{cases}$$
\end{defn}


We claim the Feynman propagator can also be written as
$$\Delta_F =\int \frac{d^4p}{(2\pi)^4}\frac{i}{p^2-m^2}e^{-ip\cdot (x-y)}.$$
Note that this is Lorentz invariant-- the volume element is certainly Lorentz invariant, and everything else is scalars. But there's an issue-- this integral has a pole whenver $p^2=m^2$, or equivalently for each value of $\pv$, $p^2-m^2=(p^0)^2-\pv^2-m^2=0$ when $p^0= \pm E_{\pv}=\pm \sqrt{ \pv^2+m^2}$. We would like to integrate over $p^0$ to recover the earlier form of the propagator, so we can either deform the contour or push the poles of the real $p^0$ axis with an \term{$i\epsilon$ prescription}.

We'll finish the proof next time, but by analytically continuing $p^0$ to the complex plane, making this $i\epsilon$ prescription, and closing the contour appropriately we can do the $p^0$ integral and find that what we get is exactly the Feynman propagator as defined earlier in terms of time ordering.

\subsection*{Proof of Exercise \ref{heisenbergkleingordon}}
Let's find the equation of motion for $\phi.$ Recall that $[\phi(\vec x),\phi(\vec y)]=0$. We can also show that $\grad \phi(y)$ and $\phi(x)$ commute: 
$$
\grad \phi(\vec y)\phi(\vec x) = \grad_y (\phi(\vec y) \phi (\vec x)) = \grad_y (\phi(\vec x) \phi(\vec y)) = \phi (\vec x) \grad \phi (\vec y)$$
so the only term in the Hamiltonian we need to worry about is the $\pi^2$ term.
\begin{align*}
    \dot \phi = i[H,\phi] &=\frac{i}{2} \int d^3 y \left[\pi^2(y)+(\nabla \phi(y))^2 + m^2\phi(y)^2, \phi(x)\right]\\
    &=\frac{i}{2} \int d^3 y (\pi^2(y) \phi(x) - \phi(x) \pi^2(y))\\
    &=\frac{i}{2} \int d^3 y (\pi(y) (-[\phi(x),\pi(y)]+\phi(x) \pi(y))-\phi(x) \pi^2(y))\\
    &=\frac{i}{2} \int d^3 y (-i\delta^3(x-y) \pi(y)+ \pi(y) \phi(x) \pi(y) - \phi(x) \pi^2(y)\\
    &=\frac{i}{2} \int d^3 y (-2i \delta^3(x-y) \pi(y))\\
    &= \pi(x).
\end{align*}
We can also compute the time evolution for $\pi$. Here, we do have to worry about the $\grad\phi$ terms as well as the $\phi$ terms.
\begin{align*}
    \dot \pi(x) = i[H,\pi(x)] &=\frac{i}{2} \int d^3 y \left[\pi^2(y)+(\nabla \phi(y))^2 + m^2\phi(y)^2, \pi(x)\right]\\
    &=\frac{i}{2} \int d^3 y \bkt{\nabla \phi(y) \nabla_y (\phi(y) \pi(x))- \nabla_y (\pi(x) \phi(y)) \nabla \phi(y)+2i m^2 \delta^3(x-y) \phi(y)}\\
    &= \frac{i}{2} \int d^3 y \bkt{\nabla \phi(y) \nabla_y\paren{[ \phi(y),\pi(x)]} - \nabla_y\paren{-[\phi(y),\pi(x)]} \nabla \phi(y)+2i m^2 \delta^3(x-y) \phi(y)}\\
    &=\frac{i}{2} \int d^3 y \bkt{\nabla \phi(y) \nabla_y(i\delta^3(y-x)) + \nabla_y(i\delta^3(y-x)) \nabla \phi(y)+2i m^2 \delta^3(x-y) \phi(y)}\\
    &= \frac{i}{2} \int d^3 y \left(-2i \delta^3(x-y) \nabla^2_y \phi(y) + 2i m^2 \delta^3(x-y) \phi(y) \right)\\
    &= \nabla^2 \phi(x)-m^2 \phi(x),
\end{align*}
where we have integrated by parts to move the $\nabla$ from the delta function to $\phi$, picking up a minus sign along the way. Thus $\phi$ obeys the equation
$$\ddot \phi = \dot \pi = \nabla^2 \phi - m^2 \phi$$
or equivalently
$$\ddot \phi - \nabla^2 \phi + m^2 = \p_\mu \p^\mu \phi +m^2=0.$$
Therefore $\phi$ satisfies the Klein-Gordon equation. (This is also in David Tong's notes.) \qed

We'll also make note of a potentially useful identity which can be proved by induction: if $[a,b]=\alpha,$ then $[a^n,b]=n\alpha a^{n-1}.$

\subsection*{Proof of Heisenberg picture $a_p,a_p^\dagger$}
Here, we'll show that
$$e^{iHt}a_p e^{-iHt}= e^{-iE_pt} a_p$$
using the commutation relation $[H,a_p]=-E_p a_p.$
First, I'll claim that 
$$H^n a_p =a (-E_p + H)^n.$$
Let's prove it by induction: for the base case, $n=1$ and
$$H a_p = [H,a_p]+ a_p H = -E_p a_p + a_p H = a_p (-E_p+H).$$
Now the inductive step: suppose the hypothesis holds for $n$. Then
$$H^{n+1} a_p = H (H^n a_p)= Ha_p (-E_p+H)^n = a_p (-E_p+H)^{n+1}.$$

Therefore we can use this in the expansion of $e^{iHt}$.
\begin{eqnarray*}
e^{iHt}a_p e^{-iHt}&=& \sum_{n=0}^\infty \frac{(iHt)^n}{n!} a_p e^{-iHt}\\
&=& a_p \sum_{n=0}^\infty \frac{ (it(-E_p +H))^n}{n!} e^{-iHt}\\
&=& a_p e^{-iE_p t} e^{iHt} e^{-iHt}\\
&=& a_p e^{-iE_pt}.
\end{eqnarray*}
Rather than repeating this whole calculation, we can simply take the hermitian conjugate of each side (since $H$ is hermitian) to get
$$e^{iHt} a_p^\dagger e^{-iHt} = e^{+iE_p t} a_p^\dagger.$$
Note that the sign flip in the exponent of $e^{\pm iHt}$ and the reversing of order from taking the hermitian conjugate cancel out. So the operators $a,a^\dagger$ do evolve in a nice way that allows us to write $\phi$ in terms of a four-vector product in the exponent, $p\cdot x$, and in turn this helps us to see that our theory has a sensible causal structure under Lorentz transformations. \qed